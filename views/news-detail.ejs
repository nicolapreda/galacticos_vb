<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        <%= article.title %> | Galacticos Vele Blu
    </title>
    <link rel="stylesheet" href="/assets/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Inter:wght@400;700;900&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F3F4F6;
        }

        h1,
        h2,
        h3 {
            font-family: 'Anton', sans-serif;
            text-transform: uppercase;
        }

        .prose p {
            margin-bottom: 1.5rem;
            line-height: 1.8;
        }
    </style>
</head>

<body class="text-galacticos-dark">
    <%- include('partials/navbar') %>

        <!-- Article Hero -->
        <header class="relative h-[60vh] min-h-[400px]">
            <img src="<%= article.image || '/assets/news-placeholder.jpg' %>" alt="<%= article.title %>"
                class="w-full h-full object-cover">
            <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent"></div>
            <div class="absolute bottom-0 left-0 w-full p-6 md:p-12">
                <div class="max-w-4xl mx-auto">
                    <span
                        class="bg-galacticos-accent text-galacticos-dark font-bold text-xs px-3 py-1 uppercase mb-4 inline-block">
                        <%= new Date(article.date).toLocaleDateString() %>
                    </span>
                    <h1 class="text-4xl md:text-6xl font-black text-white leading-tight mb-4 drop-shadow-lg">
                        <%= article.title %>
                    </h1>
                </div>
            </div>
        </header>

        <div class="max-w-4xl mx-auto px-6 -mt-10 relative z-10 pb-24">
            <!-- Content -->
            <article class="bg-white p-8 md:p-12 shadow-xl mb-12 prose max-w-none text-lg text-gray-700">
                <%- article.content %>
            </article>

            <!-- Comments Section -->
            <section class="bg-white p-8 md:p-12 shadow-xl">
                <h3 class="text-3xl font-black mb-8 border-b border-gray-100 pb-4">Commenti (<%= comments ?
                        comments.length : 0 %>)</h3>

                <!-- Comment Form -->
                <form id="comment-form" class="mb-12">
                    <input type="hidden" name="news_id" value="<%= article.id %>">
                    <div class="mb-4">
                        <label class="block text-sm font-bold uppercase tracking-wide mb-2" for="author">Nome</label>
                        <input
                            class="w-full bg-gray-50 border border-gray-200 p-3 font-bold focus:outline-none focus:border-galacticos-blue transition-colors"
                            type="text" name="author" placeholder="Il tuo nome" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-bold uppercase tracking-wide mb-2"
                            for="content">Commento</label>
                        <textarea
                            class="w-full bg-gray-50 border border-gray-200 p-3 font-medium h-32 focus:outline-none focus:border-galacticos-blue transition-colors"
                            name="content" placeholder="Scrivi il tuo pensiero..." required></textarea>
                    </div>
                    <button type="submit" class="btn-primary w-full md:w-auto">
                        Pubblica Commento
                    </button>
                </form>

                <!-- Comments List -->
                <div class="space-y-8" id="comments-list">
                    <% if (comments && comments.length> 0) { %>
                        <% comments.forEach(comment=> { %>
                            <div class="flex gap-4">
                                <div
                                    class="w-10 h-10 bg-gray-200 rounded-full flex-shrink-0 flex items-center justify-center font-bold text-gray-500">
                                    <%= comment.author.charAt(0).toUpperCase() %>
                                </div>
                                <div>
                                    <div class="flex items-center gap-2 mb-1">
                                        <span class="font-bold text-galacticos-dark">
                                            <%= comment.author %>
                                        </span>
                                        <span class="text-xs text-gray-400 font-medium uppercase">
                                            <%= new Date(comment.date).toLocaleDateString() %>
                                        </span>
                                    </div>
                                    <p class="text-gray-600 border-l-2 border-gray-100 pl-4 py-1">
                                        <%= comment.content %>
                                    </p>
                                </div>
                            </div>
                            <% }); %>
                                <% } else { %>
                                    <p class="text-gray-400 italic text-center py-8">Non ci sono ancora commenti. Sii il
                                        primo a commentare!</p>
                                    <% } %>
                </div>
            </section>
        </div>

        <script>
            document.getElementById('comment-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                const data = Object.fromEntries(formData.entries());

                try {
                    const response = await fetch('/api/comments', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });

                    if (response.ok) {
                        window.location.reload();
                    } else {
                        alert('Errore durante l\'invio del commento');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('Errore di connessione');
                }
            });
        </script>

        <%- include('partials/footer') %>
</body>

</html>